--------------------------------------------------------------------------------
                                  HEATh
--------------------------------------------------------------------------------

author:       https://github.com/axkf
dependencies: bash 4.4.20(1) , GNU awk 4.2.1 , Gnuplot 5.2
version:      2024-04-27


  HEATh is a tool to calculate Gibbs free energies of solid phases from phonopy
  thermal_properties files. It can be used to get values for specific temperatures 
  and pressures or output formula strings, that can be utilized as input for 
  other programs.


------------------------------ GENERAL USAGE -----------------------------------

    path/HEATh [-options] [-fT/fO/fP files]

------------------------------ FILES / INPUT -----------------------------------

  
  Unfortunately there is no file, that contains all necessary information. Three
  files are therefore needed per structure: The OUTCAR file, which contains the
  energy and structure, the thermal_properties.yaml file generated by phonopy, and
  optionally a phonopy.yaml file, which lists structure and space group. The latter
  might be useful to distinguish compounds with like composition. Only inputting
  one or two file types is possible, even though the results will be incomplete.
  
  Since especially the thermal_properties files lack structural information, 
  manual assignment is required for the script to work properly. The files there-
  fore need to be input as three space-separated strings. The file type is
  then indicated by a prefix: -fO (OUTCAR files), -fT (thermal_properties.yaml 
  files) and -fP (phonopy.yaml files). While the file names do not matter, their
  number and ordering needs to be the same (or zero).
  
  Example:
  
    -fO OUTCAR1 OUTCAR2 -fT THERM1.yaml THERM2.yaml -fP ...
  

-------------------------- OPTIONS AND PRINTING --------------------------------


  As for the files, the number of parameters in the options below need to match
  the number of files. In case of only one parameter being given, it will be used 
  for all files. If no parameter is defined, the script will skip all related 
  calculations. The following parameter options are available:


TEMPERATURE:

  The calculation temperature is defined (in Kelvin) using the -T modifier. Using
  another separator, it is possible to define temperature lists for specific files.
  In this case, each of the calculations will be treated like a separate file (each 
  calculation receives its own array index to access the values).

  Example (4 structures):

    -T 298.15 300#400#500 412,412.1,412.2,412.3,412.4 666

  This performs single calculations for the structures 1 and 4 (298.15 K and 666 K) 
  and serial calculations for the structures 2 (300 K, 400 K, 500 K) and 3 (412 K, 
  412.1 K, 412.2 K, 412.3 K, 412.4 K).


CORRECTIONS:

  HEATh offers the option to modify enthalpy (-cH), entropy (-cS) and/or Gibbs 
  free energy (-cG) by inputting mathematical terms. This can be used to convert 
  units or add extra terms. The terms should be quoted to prevent shell inter-
  ference. Since the assignment rules described above apply here as well, no spaces 
  are allowed within terms. Make sure there is an operator connecting the 
  correction to the original expression and to include unit conversions factors. 
  All operators implemented in GNU awk as well as some fundamental constants (see 
  chapter EXPORT) can be used.

  Example (3 structures):

    -cG "-R*T*log(3) *2+12.3456 /1000."


FIT PARAMETERS:

  To obtain a continuous representation of the phonopy values, a fit of the heat 
  capacity is conducted using the shomate equation:

    Cp(T) = a0 + a1*T + a2/2*T^2 + a3/3*T^3 + a4/4*T^4 - a5/T^2

  Enthalpy and entropy are then derived by integration. To allow for a smooth 
  transition, a0 is constrained to reproduce the Cp value calculated by phonopy 
  at a specified temperature (analogously the constants a6 and a7 in the enthalpy-
  and entropy expressions are based on the corresponding phonopy values).

  The fit parameters allow for a costumization of the fit range, as well as the 
  fixed reference temperature. The latter is compared to the data points contained 
  in the thermal_properties.yaml file and will be adjusted to match the closest 
  point within range. If no reference point is specified, the data value closest 
  to 300K and within range will be used. Similarly the minimum temperature will 
  default to 100K, if it is undefined or lower, since the Shomate equation is not 
  valid for small temperatures. All points above the minimum temperature will be
  used for fitting, if no upper boundary is defined.

  All temperatures need to be given in Kelvin using the format 
  
    Tmin:Tref:Tmax 
  
  for each file individually or for all at once by only definig one set of fit 
  parameters. The following abbreviations are allowed:

    Tmin: = Tmin:: , :Tmax = ::Tmax , Tmin:Tmax = Tmin::Tmax , Tref = :Tref:

  Example (5 structures): 

    -f 222:456.7:1200 298.15 124: :312:999 265:789
 
  is equivalent to
  
    -f 222:456.7:1200 100:298.15: 124:300: 100:312:999 265:300:789

  provided, the specified reference temperatures do exist.


---------------------------------- OUTPUT --------------------------------------


PRINTING:

  Calculated values can be printed by calling the -p option. By default this prints  
  the sum formula, energy, zero-point energy, enthalpy change, evaluated enthalpy 
  correction and total enthalpy, entropy correction and total entropy, as well as
  the correction of the Gibbs free energy and its total value. All values are given
  in kJ/mol except for the entropy (J/mol/K). Please use the correction options, to 
  convert to another unit.
  
  Contents and format of the output table are freely customizable by specifying the 
  desired arrys (see EXPORT) and their format as a printf-string. For example
  
    -p '"%-10s %.2f\n" ${A_HTH_CMPND[$number]} ${A_HTH_VAL_energy[$number]}'
  
  prints the sum formulas, as well as the energies as floating point numbers with a 
  precision of two digits. Printing is done for the whole array ($number being the 
  counting variable). Please quote the format string as shown in the example. For 
  safety reasons any semicolon in the string will be deleted.


EXPORT:

  Using the shell utility "source" via
  
    source path/HEATh [-options] [-fT/fO/fP files]
  
  or
  
    . path/HEATh [-options] [-fT/fO/fP files]

  allows for direct access of all calculated values via indexed bash arrays.
  Accessible arrays include a list of the processed files and their indicies,

    A_HTH_INDEX_OUTCAR
    A_HTH_INDEX_PHONOPY
    A_HTH_INDEX_THERMAL_PROPERTIES
    A_HTH_FILES_OUTCAR
    A_HTH_FILES_PHONOPY
    A_HTH_FILES_THERMAL_PROPERTIES
  
  structure-related data, like the sum formula, the number of atoms and formula 
  units within the unit cell, the elements involved and their quantity, as well 
  as symmetry information

    A_HTH_CMPND
    A_HTH_ELEM
    A_HTH_ELEZ
    A_HTH_ATOMS_OUTCAR
    A_HTH_FUNITS_OUTCAR
    A_HTH_ATOMS_PHONOPY
    A_HTH_FUNITS_PHONOPY
    A_HTH_ATOMS
    A_HTH_FUNITS
    A_HTH_SYM
    A_HTH_SYSTEM
    A_HTH_SYSTEM_FILES

  Additionally, all calculated values, including the shomate parameters and the 
  fit error, are listed. 

    A_HTH_VAL_energy
    A_HTH_VAL_zpe
    A_HTH_VAL_a1
    A_HTH_VAL_a2
    A_HTH_VAL_a3
    A_HTH_VAL_a4
    A_HTH_VAL_a5
    A_HTH_VAL_a6
    A_HTH_VAL_a7
    A_HTH_VAL_err
    A_HTH_VAL_Cp_total
    A_HTH_VAL_H_diff
    A_HTH_VAL_H_total
    A_HTH_VAL_S_corr
    A_HTH_VAL_S_total
    A_HTH_VAL_G_corr
    A_HTH_VAL_G_total

  Formula strings are generated for all thermodynamic properties

    A_HTH_FML_Cp_total
    A_HTH_FML_H_diff
    A_HTH_FML_H_total
    A_HTH_FML_S_total
    A_HTH_FML_G_total

  which can be used for other calculations or plotting. Finally, some fundamental 
  constants are included as well:

    NA = 6.02214076E+23
    h  = 6.62607015E-34
    kB = 1.380649E-23
    R  = 8.31446261815324
    F  = 96485
    u  = 1.6605390666050E-27

  These can also be used for corrections of the enthalpy, entropy or Gibbs free 
  energy.


CUSTOM ELEMENT ORDERING:

  Invoking the ordering option "-o" allows for a custom ordering of the sum formulas 
  and the related arrays A_HTH_ELEM and A_HTH_ELEZ, which contain information about 
  the contents of the unit cell. This might be useful for postprocessing the results.
  
  Elements or groups of elements (1-18,3d-6d,4f,5f) listed after the -o modifier will
  be ordered according to the list. The remaining elements within the group "X" or 
  within other groups are ordered according to IUPAC pseudo-electronegativity. In 
  case of conflicting groups/elements the first appearence of an element is decisive. 
  If not mentioned explicitly, "X" is appended to the end of the string (-o without 
  definition is therefore equivalent to -o "X").

  Example:

    -o "Cu 3d 11 Ag"

  is equivalent to

    -o "Cu Sc Ti V Cr Mn Fe Co Ni (Cu) Zn Rg Au Ag (Cu) (Ag) X"

  Elements in parantheses are ignored in this case due to doubling.
